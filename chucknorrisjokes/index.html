<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js">
<!--<![endif]-->

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Take Me to Chuck Norris</title>

    <!--[if lt IE 9]>
        <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
    <!-- Bootstrap libraries -->
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css"
        integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">

    <!-- Latest compiled and minified JavaScript -->
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js"
        integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut"
        crossorigin="anonymous"></script>

    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js"
        integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k"
        crossorigin="anonymous"></script>



</head>


<body style='background-color:#FCFCFC'>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <a class="navbar-brand" href=".">CHUCK JOKES</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item active">
                    <a class="nav-link" href="./">Home <span class="sr-only">(current)</span></a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="./about.html">About</a>
                </li>
            </ul>
        </div>
    </nav>

    <main role="main" class="container">
        <div class='container'>

            <div id='mainText' class='container'>
                <div class='row'>
                    <div class="col">
                        <img id='leftImg' class='img-thumbnail img-responsive'
                            src="https://upload.wikimedia.org/wikipedia/commons/b/b1/Chuck_Norris%2C_The_Delta_Force_1986.jpg"
                            alt='Picture of Handsome Chuck Norris '>

                        <style>
                            #leftImg {
                                -webkit-transform: scaleX(-1);
                                transform: scaleX(-1);
                            }
                        </style>

                    </div>

                    <div id="oldSchool" class="col-6 align-self-center text-center">

                        <span class="span1">GET CHUCK NORRISED</span>
                        <span class="span1">GET CHUCK NORRISED</span>
                        <span class="span1">GET CHUCK NORRISED</span>


                        <style>
                            #oldSchool {
                                font-family: "proxima-nova-1", "proxima-nova-2", "Helvetica Neue", "Arial", sans-serif;
                            }

                            #oldSchool .span1 {
                                font-weight: 800;
                                text-transform: uppercase;
                                font-size: 2.5vw;
                                line-height: 1.1em;
                                display: block;

                                color: #fff;
                                text-shadow: 1px 1px #58E, 2px 2px #58E, 3px 3px #58E, 4px 4px #58E, 5px 5px #58E;
                            }
                        </style>

                    </div>

                    <div class="col">
                        <img class='img-thumbnail img-responsive'
                            src="https://upload.wikimedia.org/wikipedia/commons/b/b1/Chuck_Norris%2C_The_Delta_Force_1986.jpg"
                            alt='Picture of Handsome Chuck Norris '>
                    </div>

                    </style>
                </div>
            </div>

        </div>

        <div class='mt-2 col-md-12'>

            <form class='form-row'>
                <div class='col pb-2 pt-5 '>
                    <label for='amount' class='font-weight-bold'>Number of Random Joke(s):</label>
                    <input id='amount' type="number" class="form-control" value=1 required>

                    <p class="lead pt-2">
                        <button id='generateJoke' type="button" class="btn btn-primary btn-lg btn-block ">Generate
                            Joke(s)</button>
                    </p>
                </div>
            </form>

            <form class='pb-2 pt-5'>
                <div>
                    <label for='amount' class='font-weight-bold'>Type in your name:</label>
                </div>
                <div class="row">
                    <div class="col">
                        <input id='fname' type="text" class="form-control" placeholder="First name">
                    </div>
                    <div class="col">
                        <input id='lname' type="text" class="form-control" placeholder="Last name">
                    </div>
                </div>
            </form>

            <p>
                <button id='customiseJoke' type="button" class="btn btn-secondary btn-lg btn-block">Customise Your Own
                    Chuck Norris Joke</button>
            </p>

            <p id='jokeText' class='font-weight-bold w25 p-3 text-left'>THE JOKES WILL GET CHUCK NORRISED HERE<br></p>
            <style>
                #jokeText {
                    font-family: "proxima-nova-1", "proxima-nova-2", "Helvetica Neue", "Arial", sans-serif;
                    font-weight: 800;
                    font-size: 2.5vw;
                    display: block;
                    top: -3px;
                    left: -3px;
                    columns: #000000;
                }
            </style>
        </div>
        </div>
    </main>

    <script>

        async function countJokesAvail() {
            var serviceURL = 'http://api.icndb.com/jokes/count';
            try {
                const response = await fetch(serviceURL, { method: 'GET' });
                if (response.ok) {
                    var data = await response.json();
                    var count = data.value;
                    console.log(data);
                    console.log(count);
                    return count;
                }
            }
            catch {
                alert("HTTP-Error: " + response.status);
                console.log(error);
                return;
            }
        }

        $('#generateJoke').click(async (event) => {

            var amount = $('#amount').val();
            var numRegEx = /^[0-9]+$/;
            var jokesAvail = await countJokesAvail();
            
            if (amount.match(numRegEx) && (parseInt(amount) <= jokesAvail)) {
                try {
                    var serviceURL = 'http://api.icndb.com/jokes/random/' + amount;
                    const response = await fetch(serviceURL, { method: 'GET' });
                    if (response.ok) {
                        $('#jokeText').empty();
                        var jokeArr = "";
                        var data = await response.json();
                        var jokeVal = data.value;
                        console.log(jokeVal);
                        for (i = 0; i < jokeVal.length; i++) {
                            jokeArr += '<li>' + jokeVal[i].joke + '</li><br>';
                            console.log(jokeVal[i].joke);
                        }
                        console.log(jokeArr);

                        $('#jokeText').append('<ol>' + jokeArr + '</ol>');
                    }
                    else {
                        alert("HTTP-Error: " + response.status);
                        console.log(error);
                    }
                } catch (error) {
                    alert("HTTP-Error: " + response.status);
                    console.log(error);
                }

            }
            else if (!(amount.match(numRegEx))) {
                alert('Please fill in positive whole numbers only! e.g. 1, 6, 9');
            }

            else {
                alert('Please fill in a number less than ' + jokesAvail);
            }

        });

        $('#customiseJoke').click(async (event) => {

            try {
                var fname = $('#fname').val();
                var lname = $('#lname').val();
                if (!fname || !lname) {
                    alert('Please fill in both first and last name!');
                }
                else {
                    var serviceURL = 'http://api.icndb.com/jokes/random?firstName=' + fname + '&lastName=' + lname;
                    const response = await fetch(serviceURL, { method: 'GET' });
                    if (response.ok) {
                        const data = await response.json()
                        $('#jokeText').empty();
                        console.log(response);
                        console.log(data.value.joke);
                        $('#jokeText').append(data.value.joke)
                    }
                    else {
                        alert("HTTP-Error: " + response.status);
                        console.log(error);
                    }
                }
            } catch (error) {
                alert("HTTP-Error: " + response.status);
                console.log(error);
            }
        });
    </script>

</body>

</html>